# Claude Code 全局工作指令

## 🎯 核心原则
**每次工作前必须执行以下步骤：**
1. 阅读所有文档，理解项目context
2. 查看开发进度，确认当前任务
3. 所有决策和想法必须文档化
4. 每完成一步必须测试并记录结果

## 📋 工作流程

### 1. 开始工作时
```bash
# 必须按顺序阅读
1. README.md          # 项目概述
2. DEVELOPMENT.md     # 开发计划和进度
3. TECH_DECISIONS.md  # 技术决策记录
4. TEST_LOG.md        # 测试记录
5. IDEAS.md           # 创意和分支想法
6. webapp_architecture.md  # Web应用架构设计（如存在）
```

### 2. 开发过程中
- **编码前**：更新DEVELOPMENT.md中的当前任务状态为"进行中"
- **编码中**：任何新想法立即记录到IDEAS.md
- **编码后**：运行测试并记录到TEST_LOG.md
- **完成后**：更新进度，标记完成时间和测试结果

### 3. 文档更新规范
- 使用时间戳：`[2025-07-03 14:30]`
- 标记状态：`✅ 完成` `🚧 进行中` `❌ 失败` `💡 想法`
- 记录决策原因和替代方案

## 🔧 技术栈约定
- Python虚拟环境：`venv/`
- 依赖管理：`requirements.txt`
- 环境变量：`.env`（不提交到git）
- 所有依赖必须记录版本号

## 🔍 问题诊断方法论
**重要：遇到问题时，必须先全面诊断，再系统解决**

### 正确的诊断流程：
1. **全面收集问题**
   - 运行完整的用户流程
   - 记录所有错误和异常
   - 不要急于解决第一个问题

2. **分析问题关联**
   - 找出问题之间的因果关系
   - 识别根本原因vs表面症状
   - 考虑修复的连锁反应

3. **制定解决方案**
   - 优先解决根本问题
   - 考虑向前兼容和向后兼容
   - 预测可能的副作用

4. **系统性实施**
   - 按优先级顺序修复
   - 每步都要验证影响
   - 保持文档同步更新

### ❌ 错误做法：
- 看到问题立即dive in解决
- "头痛医头，脚痛医脚"
- 只考虑正向流程，忽略反向操作

## 📝 文档模板

### 开发任务记录模板
```markdown
### [任务名称]
- **状态**: 🚧 进行中
- **开始时间**: [2025-07-03 14:30]
- **预计耗时**: 2小时
- **实际耗时**: -
- **负责人**: Claude Code

#### 任务描述
[详细描述]

#### 实现方案
[技术方案]

#### 测试结果
- [ ] 单元测试
- [ ] 集成测试
- [ ] 用户测试

#### 遇到的问题
[记录所有问题和解决方案]

#### 完成标记
- **完成时间**: -
- **测试通过**: -
- **代码位置**: -
```

## ⚠️ 重要提醒
1. **不要跳过文档阅读**：context理解错误会导致返工
2. **不要延迟记录**：想法和问题必须立即记录
3. **不要忽略测试**：每步都要验证，确保稳定性

## 🧠 Context管理
**关键原则**：文档是项目的持久记忆！

### Terminal关闭时会丢失：
- 对话历史和工作记忆
- 临时决策和问题诊断过程
- 未记录的解决方案

### 如何保护Context：
1. **立即记录** - 重要决策和解决方案马上写入文档
2. **定期检查** - 使用TodoRead确认任务状态
3. **文档优先** - 相信文档而非记忆
4. **避免YOLO** - 不要凭记忆工作，始终先读文档

### 恢复Context步骤：
1. 按顺序阅读所有文档
2. 检查最近的更新时间
3. 运行诊断脚本确认环境状态
4. 查看git log了解最近改动

## 🎪 分支管理
- 所有实验性想法先在IDEAS.md中记录
- 评估可行性后再创建代码分支
- 废弃的想法也要保留，注明废弃原因

---
*最后更新: 2025-07-04*